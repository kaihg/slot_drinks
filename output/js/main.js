var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var App;
(function (App) {
    var Constants = /** @class */ (function () {
        function Constants() {
        }
        Constants.SYMBOL_WIDTH = 100;
        Constants.SYMBOL_HEIGHT = 100;
        return Constants;
    }());
    App.Constants = Constants;
})(App || (App = {}));
var App;
(function (App) {
    var Main = /** @class */ (function () {
        function Main() {
            this.initPIXI();
            this.startLoading();
        }
        Main.prototype.initPIXI = function () {
            this.app = new PIXI.Application(window.innerWidth, window.innerHeight, { backgroundColor: 0x1099bb });
            document.body.appendChild(this.app.view);
        };
        Main.prototype.startLoading = function () {
            var _this = this;
            var loadingView = new view.LoadingView();
            loadingView.x = this.app.screen.width / 2;
            loadingView.y = this.app.screen.height / 2;
            this.app.stage.addChild(loadingView);
            PIXI.loader
                .on("progress", function (loader, resource) { loadingView.updateProgress(loader.progress); })
                .add("shops", "resource/shops.json")
                .load(function () {
                loadingView.parent.removeChild(loadingView);
                _this.onLoaded();
            });
        };
        Main.prototype.onLoaded = function () {
            this.initReelView(PIXI.loader.resources.shops.data);
            this.initSpinButton();
        };
        Main.prototype.initReelView = function (shops) {
            console.log(shops);
            var reel = new view.ReelView(shops);
            reel.x = this.app.screen.width / 2;
            reel.y = this.app.screen.height / 2;
            reel.updateShop([0, 0, 0]);
            this.app.stage.addChild(reel);
            this.reelView = reel;
        };
        Main.prototype.initSpinButton = function () {
            var btn = new PIXI.Text("開始");
            btn.x = this.app.screen.width - 64;
            btn.y = this.app.screen.height - 48;
            btn.interactive = true;
            btn.on('pointerup', this.spin.bind(this));
            this.app.stage.addChild(btn);
        };
        Main.prototype.spin = function () {
            this.reelView.onSpin();
        };
        return Main;
    }());
    App.Main = Main;
})(App || (App = {}));
var view;
(function (view) {
    var LoadingView = /** @class */ (function (_super) {
        __extends(LoadingView, _super);
        function LoadingView() {
            var _this = _super.call(this) || this;
            _this.progress = 0;
            _this.color = 0xaabc13;
            return _this;
        }
        LoadingView.prototype.updateProgress = function (p) {
            var percent = p;
            this.progress = percent;
            this.clear();
            this.lineStyle(10, this.color);
            // this.drawCircle(0, 0, 2 * Math.PI * percent);
            this.arc(0, 0, 50, 0, 2 * Math.PI * percent);
            this.endFill();
        };
        return LoadingView;
    }(PIXI.Graphics));
    view.LoadingView = LoadingView;
})(view || (view = {}));
var view;
(function (view) {
    var ReelView = /** @class */ (function (_super) {
        __extends(ReelView, _super);
        // private _mask: PIXI.DisplayObject;
        function ReelView(shops) {
            var _this = _super.call(this) || this;
            _this.tempIds = [1, 1, 1];
            _this.shops = shops;
            var width = App.Constants.SYMBOL_WIDTH;
            var height = App.Constants.SYMBOL_HEIGHT;
            _this.frame = new PIXI.Graphics();
            _this.frame.lineStyle(10, 0x000000);
            _this.frame.drawRect(-width * 0.5, -height * 0.5, width, height);
            _this.frame.endFill();
            // mask
            var mask = new PIXI.Graphics();
            mask.beginFill(0xFFFFFF);
            mask.drawRect(-width * 0.5, -height * 0.5, width, height);
            mask.endFill();
            // wheel
            var wheel = new view.WheelView(shops);
            wheel.mask = mask;
            wheel.setIds(_this.tempIds);
            _this.wheel = wheel;
            _this.addChild(wheel, mask, _this.frame);
            return _this;
        }
        ReelView.prototype.updateShop = function (shopId) {
            this.wheel.setIds(shopId);
        };
        ReelView.prototype.onSpin = function () {
            if (this.spining) {
                return;
            }
            this.spining = true;
            TweenMax.fromTo(this.wheel.position, 0.5, { y: 0 }, { y: App.Constants.SYMBOL_HEIGHT, repeat: 5, ease: Linear.easeNone, onRepeat: this.swapId, onRepeatScope: this, onComplete: this.onSpinComplete, onCompleteScope: this });
        };
        ReelView.prototype.randomId = function () {
            return Math.floor(Math.random() * this.shops.length);
        };
        ReelView.prototype.swapId = function () {
            this.tempIds.unshift(this.randomId());
            this.updateShop(this.tempIds);
        };
        ReelView.prototype.onSpinComplete = function () {
            this.spining = false;
            this.tempIds.unshift(this.randomId());
            this.tempIds.unshift(this.randomId());
            this.updateShop(this.tempIds);
            TweenLite.fromTo(this.wheel.position, 1, { y: -App.Constants.SYMBOL_HEIGHT }, { y: 0 });
        };
        return ReelView;
    }(PIXI.Sprite));
    view.ReelView = ReelView;
})(view || (view = {}));
var view;
(function (view) {
    var WheelView = /** @class */ (function (_super) {
        __extends(WheelView, _super);
        function WheelView(shops) {
            var _this = _super.call(this, PIXI.Texture.EMPTY) || this;
            _this.shops = shops;
            for (var i = 0; i < 3; i++) {
                var symbolText = new PIXI.Text("", { fill: "0x000000" });
                symbolText.anchor.set(0.5);
                var bg = new PIXI.Sprite(PIXI.Texture.WHITE);
                bg.width = App.Constants.SYMBOL_WIDTH;
                bg.height = App.Constants.SYMBOL_HEIGHT;
                bg.anchor.set(0.5);
                var container = new PIXI.Container();
                container.addChild(bg, symbolText);
                container.y = (i - 1) * App.Constants.SYMBOL_HEIGHT;
                _this.addChild(container);
            }
            return _this;
        }
        WheelView.prototype.setIds = function (ids) {
            var _this = this;
            this.children.forEach(function (child, i) {
                var textView = child.getChildAt(1);
                textView.text = _this.shops[ids[i]];
            });
        };
        return WheelView;
    }(PIXI.Sprite));
    view.WheelView = WheelView;
})(view || (view = {}));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9Db25zdGFudHMudHMiLCJzcmMvTWFpbi50cyIsInNyYy92aWV3L0xvYWRpbmdWaWV3LnRzIiwic3JjL3ZpZXcvUmVlbFZpZXcudHMiLCJzcmMvdmlldy9XaGVlbFZpZXcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLElBQU8sR0FBRyxDQUtUO0FBTEQsV0FBTyxHQUFHO0lBQ047UUFBQTtRQUdBLENBQUM7UUFGaUIsc0JBQVksR0FBRyxHQUFHLENBQUM7UUFDbkIsdUJBQWEsR0FBRyxHQUFHLENBQUM7UUFDdEMsZ0JBQUM7S0FIRCxBQUdDLElBQUE7SUFIWSxhQUFTLFlBR3JCLENBQUE7QUFDTCxDQUFDLEVBTE0sR0FBRyxLQUFILEdBQUcsUUFLVDtBQ0xELElBQU8sR0FBRyxDQXVFVDtBQXZFRCxXQUFPLEdBQUc7SUFDTjtRQU1JO1lBRUksSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ2hCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUV4QixDQUFDO1FBRU8sdUJBQVEsR0FBaEI7WUFDSSxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxXQUFXLEVBQUUsRUFBRSxlQUFlLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztZQUN0RyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdDLENBQUM7UUFFRCwyQkFBWSxHQUFaO1lBQUEsaUJBZUM7WUFkRyxJQUFJLFdBQVcsR0FBRyxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN6QyxXQUFXLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7WUFDMUMsV0FBVyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1B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O2FBQzVCOztRQUNMLENBQUM7UUFFRCwwQkFBTSxHQUFOLFVBQU8sR0FBWTtZQUFuQixpQkFLQztZQUpHLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFVBQUMsS0FBc0IsRUFBRyxDQUFDO2dCQUM3QyxJQUFJLFFBQVEsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBYyxDQUFDO2dCQUNoRCxRQUFRLENBQUMsSUFBSSxHQUFHLEtBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkMsQ0FBQyxDQUFDLENBQUE7UUFDTixDQUFDO1FBRUwsZ0JBQUM7SUFBRCxDQWpDQSxBQWlDQyxDQWpDOEIsSUFBSSxDQUFDLE1BQU0sR0FpQ3pDO0lBakNZLGNBQVMsWUFpQ3JCLENBQUE7QUFDTCxDQUFDLEVBbkNNLElBQUksS0FBSixJQUFJLFFBbUNWIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUgQXBwIHtcbiAgICBleHBvcnQgY2xhc3MgQ29uc3RhbnRzIHtcbiAgICAgICAgcHVibGljIHN0YXRpYyBTWU1CT0xfV0lEVEggPSAxMDA7XG4gICAgICAgIHB1YmxpYyBzdGF0aWMgU1lNQk9MX0hFSUdIVCA9IDEwMDtcbiAgICB9XG59IiwibW9kdWxlIEFwcCB7XG4gICAgZXhwb3J0IGNsYXNzIE1haW4ge1xuXG4gICAgICAgIHByaXZhdGUgYXBwOiBQSVhJLkFwcGxpY2F0aW9uO1xuXG4gICAgICAgIHByaXZhdGUgcmVlbFZpZXcgOiB2aWV3LlJlZWxWaWV3O1xuXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xuXG4gICAgICAgICAgICB0aGlzLmluaXRQSVhJKCk7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0TG9hZGluZygpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBwcml2YXRlIGluaXRQSVhJKCkge1xuICAgICAgICAgICAgdGhpcy5hcHAgPSBuZXcgUElYSS5BcHBsaWNhdGlvbih3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0LCB7IGJhY2tncm91bmRDb2xvcjogMHgxMDk5YmIgfSk7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuYXBwLnZpZXcpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3RhcnRMb2FkaW5nKCk6IGFueSB7XG4gICAgICAgICAgICBsZXQgbG9hZGluZ1ZpZXcgPSBuZXcgdmlldy5Mb2FkaW5nVmlldygpO1xuICAgICAgICAgICAgbG9hZGluZ1ZpZXcueCA9IHRoaXMuYXBwLnNjcmVlbi53aWR0aCAvIDI7XG4gICAgICAgICAgICBsb2FkaW5nVmlldy55ID0gdGhpcy5hcHAuc2NyZWVuLmhlaWdodCAvIDI7XG5cbiAgICAgICAgICAgIHRoaXMuYXBwLnN0YWdlLmFkZENoaWxkKGxvYWRpbmdWaWV3KTtcblxuICAgICAgICAgICAgUElYSS5sb2FkZXJcbiAgICAgICAgICAgICAgICAub24oXCJwcm9ncmVzc1wiLCAobG9hZGVyOiBQSVhJLmxvYWRlcnMuTG9hZGVyLCByZXNvdXJjZTogUElYSS5sb2FkZXJzLlJlc291cmNlKSA9PiB7IGxvYWRpbmdWaWV3LnVwZGF0ZVByb2dyZXNzKGxvYWRlci5wcm9ncmVzcykgfSlcbiAgICAgICAgICAgICAgICAuYWRkKFwic2hvcHNcIiwgXCJyZXNvdXJjZS9zaG9wcy5qc29uXCIpXG4gICAgICAgICAgICAgICAgLmxvYWQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsb2FkaW5nVmlldy5wYXJlbnQucmVtb3ZlQ2hpbGQobG9hZGluZ1ZpZXcpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uTG9hZGVkKCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIG9uTG9hZGVkKCkge1xuICAgICAgICAgICAgdGhpcy5pbml0UmVlbFZpZXcoUElYSS5sb2FkZXIucmVzb3VyY2VzLnNob3BzLmRhdGEpO1xuICAgICAgICAgICAgdGhpcy5pbml0U3BpbkJ1dHRvbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgaW5pdFJlZWxWaWV3KHNob3BzIDogc3RyaW5nW10pe1xuICAgICAgICAgICAgY29uc29sZS5sb2coc2hvcHMpO1xuICAgICAgICAgICAgbGV0IHJlZWwgPSBuZXcgdmlldy5SZWVsVmlldyhzaG9wcyk7XG4gICAgICAgICAgICByZWVsLnggPSB0aGlzLmFwcC5zY3JlZW4ud2lkdGggLyAyO1xuICAgICAgICAgICAgcmVlbC55ID0gdGhpcy5hcHAuc2NyZWVuLmhlaWdodCAvIDI7XG4gICAgICAgICAgICByZWVsLnVwZGF0ZVNob3AoWzAsMCwwXSk7XG5cblxuICAgICAgICAgICAgdGhpcy5hcHAuc3RhZ2UuYWRkQ2hpbGQocmVlbCk7XG5cbiAgICAgICAgICAgIHRoaXMucmVlbFZpZXcgPSByZWVsO1xuICAgICAgICB9XG5cbiAgICAgICAgaW5pdFNwaW5CdXR0b24oKXtcbiAgICAgICAgICAgIGxldCBidG4gPSBuZXcgUElYSS5UZXh0KFwi6ZaL5aeLXCIpO1xuICAgICAgICAgICAgYnRuLnggPSB0aGlzLmFwcC5zY3JlZW4ud2lkdGggLSA2NDtcbiAgICAgICAgICAgIGJ0bi55ID0gdGhpcy5hcHAuc2NyZWVuLmhlaWdodCAtIDQ4O1xuICAgICAgICAgICAgYnRuLmludGVyYWN0aXZlPSAgdHJ1ZTtcbiAgICAgICAgICAgIGJ0bi5vbigncG9pbnRlcnVwJyx0aGlzLnNwaW4uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgICAgIHRoaXMuYXBwLnN0YWdlLmFkZENoaWxkKGJ0bik7XG4gICAgICAgICAgICBcbiAgICAgICAgfVxuXG4gICAgICAgIHNwaW4oKXsgICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMucmVlbFZpZXcub25TcGluKCk7XG4gICAgICAgIH1cblxuXG4gICAgfVxufVxuIiwibW9kdWxlIHZpZXcge1xuICAgIGV4cG9ydCBjbGFzcyBMb2FkaW5nVmlldyBleHRlbmRzIFBJWEkuR3JhcGhpY3Mge1xuXG4gICAgICAgIHByaXZhdGUgcHJvZ3Jlc3M6IG51bWJlciA9IDA7XG4gICAgICAgIGNvbG9yOiBudW1iZXIgPSAweGFhYmMxM1xuXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHB1YmxpYyB1cGRhdGVQcm9ncmVzcyhwOiBudW1iZXIpIHtcbiAgICAgICAgICAgIGxldCBwZXJjZW50ID0gcDtcbiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MgPSBwZXJjZW50O1xuXG4gICAgICAgICAgICB0aGlzLmNsZWFyKCk7XG4gICAgICAgICAgICB0aGlzLmxpbmVTdHlsZSgxMCwgdGhpcy5jb2xvcik7XG4gICAgICAgICAgICAvLyB0aGlzLmRyYXdDaXJjbGUoMCwgMCwgMiAqIE1hdGguUEkgKiBwZXJjZW50KTtcbiAgICAgICAgICAgIHRoaXMuYXJjKDAsIDAsIDUwLCAwLCAyICogTWF0aC5QSSAqIHBlcmNlbnQpO1xuICAgICAgICAgICAgdGhpcy5lbmRGaWxsKCk7XG4gICAgICAgIH1cblxuICAgIH1cbn1cbiIsIm1vZHVsZSB2aWV3IHtcbiAgICBleHBvcnQgY2xhc3MgUmVlbFZpZXcgZXh0ZW5kcyBQSVhJLlNwcml0ZSB7XG5cbiAgICAgICAgcHJpdmF0ZSBmcmFtZTogUElYSS5HcmFwaGljcztcbiAgICAgICAgcHJpdmF0ZSB3aGVlbDogdmlldy5XaGVlbFZpZXc7XG4gICAgICAgIHByaXZhdGUgc2hvcHM6IHN0cmluZ1tdO1xuXG4gICAgICAgIHByaXZhdGUgdGVtcElkczogbnVtYmVyW10gPSBbMSwgMSwgMV07XG4gICAgICAgIHNwaW5pbmc6IGJvb2xlYW47XG4gICAgICAgIC8vIHByaXZhdGUgX21hc2s6IFBJWEkuRGlzcGxheU9iamVjdDtcblxuICAgICAgICBjb25zdHJ1Y3RvcihzaG9wczogc3RyaW5nW10pIHtcbiAgICAgICAgICAgIHN1cGVyKCk7XG4gICAgICAgICAgICB0aGlzLnNob3BzID0gc2hvcHM7XG5cbiAgICAgICAgICAgIGxldCB3aWR0aCA9IEFwcC5Db25zdGFudHMuU1lNQk9MX1dJRFRIO1xuICAgICAgICAgICAgbGV0IGhlaWdodCA9IEFwcC5Db25zdGFudHMuU1lNQk9MX0hFSUdIVDtcblxuICAgICAgICAgICAgdGhpcy5mcmFtZSA9IG5ldyBQSVhJLkdyYXBoaWNzKCk7XG4gICAgICAgICAgICB0aGlzLmZyYW1lLmxpbmVTdHlsZSgxMCwgMHgwMDAwMDApO1xuICAgICAgICAgICAgdGhpcy5mcmFtZS5kcmF3UmVjdCgtd2lkdGggKiAwLjUsIC1oZWlnaHQgKiAwLjUsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICAgICAgdGhpcy5mcmFtZS5lbmRGaWxsKCk7XG5cbiAgICAgICAgICAgIC8vIG1hc2tcbiAgICAgICAgICAgIGxldCBtYXNrID0gbmV3IFBJWEkuR3JhcGhpY3MoKTtcbiAgICAgICAgICAgIG1hc2suYmVnaW5GaWxsKDB4RkZGRkZGKTtcbiAgICAgICAgICAgIG1hc2suZHJhd1JlY3QoLXdpZHRoICogMC41LCAtaGVpZ2h0ICogMC41LCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICAgIG1hc2suZW5kRmlsbCgpO1xuXG5cbiAgICAgICAgICAgIC8vIHdoZWVsXG4gICAgICAgICAgICBsZXQgd2hlZWwgPSBuZXcgdmlldy5XaGVlbFZpZXcoc2hvcHMpO1xuICAgICAgICAgICAgd2hlZWwubWFzayA9IG1hc2s7XG4gICAgICAgICAgICB3aGVlbC5zZXRJZHModGhpcy50ZW1wSWRzKTtcbiAgICAgICAgICAgIHRoaXMud2hlZWwgPSB3aGVlbDtcblxuXG4gICAgICAgICAgICB0aGlzLmFkZENoaWxkKHdoZWVsLCBtYXNrLCB0aGlzLmZyYW1lKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgdXBkYXRlU2hvcChzaG9wSWQ6IG51bWJlcltdKSB7XG4gICAgICAgICAgICB0aGlzLndoZWVsLnNldElkcyhzaG9wSWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgb25TcGluKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3BpbmluZykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc3BpbmluZyA9IHRydWU7XG4gICAgICAgICAgICBUd2Vlbk1heC5mcm9tVG8odGhpcy53aGVlbC5wb3NpdGlvbiwgMC41LCB7IHk6IDAgfSwgeyB5OiBBcHAuQ29uc3RhbnRzLlNZTUJPTF9IRUlHSFQsIHJlcGVhdDogNSwgZWFzZTogTGluZWFyLmVhc2VOb25lLCBvblJlcGVhdDogdGhpcy5zd2FwSWQsIG9uUmVwZWF0U2NvcGU6IHRoaXMsIG9uQ29tcGxldGU6IHRoaXMub25TcGluQ29tcGxldGUsIG9uQ29tcGxldGVTY29wZTogdGhpcyB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgcmFuZG9tSWQoKTogbnVtYmVyIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLnNob3BzLmxlbmd0aCk7XG4gICAgICAgIH1cblxuICAgICAgICBzd2FwSWQoKSB7XG4gICAgICAgICAgICB0aGlzLnRlbXBJZHMudW5zaGlmdCh0aGlzLnJhbmRvbUlkKCkpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVTaG9wKHRoaXMudGVtcElkcyk7XG4gICAgICAgIH1cblxuICAgICAgICBvblNwaW5Db21wbGV0ZSgpIHtcblxuICAgICAgICAgICAgdGhpcy5zcGluaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnRlbXBJZHMudW5zaGlmdCh0aGlzLnJhbmRvbUlkKCkpO1xuICAgICAgICAgICAgdGhpcy50ZW1wSWRzLnVuc2hpZnQodGhpcy5yYW5kb21JZCgpKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU2hvcCh0aGlzLnRlbXBJZHMpO1xuXG4gICAgICAgICAgICBUd2VlbkxpdGUuZnJvbVRvKHRoaXMud2hlZWwucG9zaXRpb24sIDEsIHsgeTogLUFwcC5Db25zdGFudHMuU1lNQk9MX0hFSUdIVCB9LCB7IHk6IDAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59IiwibW9kdWxlIHZpZXcge1xuICAgIGV4cG9ydCBjbGFzcyBXaGVlbFZpZXcgZXh0ZW5kcyBQSVhJLlNwcml0ZSB7XG5cbiAgICAgICAgcHJpdmF0ZSBzaG9wczogc3RyaW5nW107XG5cbiAgICAgICAgY29uc3RydWN0b3Ioc2hvcHM6IHN0cmluZ1tdKSB7XG4gICAgICAgICAgICBzdXBlcihQSVhJLlRleHR1cmUuRU1QVFkpO1xuICAgICAgICAgICAgdGhpcy5zaG9wcyA9IHNob3BzO1xuXG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IHN5bWJvbFRleHQgPSBuZXcgUElYSS5UZXh0KFwiXCIsIHsgZmlsbDogXCIweDAwMDAwMFwiIH0pO1xuICAgICAgICAgICAgICAgIHN5bWJvbFRleHQuYW5jaG9yLnNldCgwLjUpO1xuXG4gICAgICAgICAgICAgICAgbGV0IGJnID0gbmV3IFBJWEkuU3ByaXRlKFBJWEkuVGV4dHVyZS5XSElURSk7XG4gICAgICAgICAgICAgICAgYmcud2lkdGggPSBBcHAuQ29uc3RhbnRzLlNZTUJPTF9XSURUSDtcbiAgICAgICAgICAgICAgICBiZy5oZWlnaHQgPSBBcHAuQ29uc3RhbnRzLlNZTUJPTF9IRUlHSFQ7XG4gICAgICAgICAgICAgICAgYmcuYW5jaG9yLnNldCgwLjUpO1xuXG4gICAgICAgICAgICAgICAgbGV0IGNvbnRhaW5lciA9IG5ldyBQSVhJLkNvbnRhaW5lcigpO1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDaGlsZChiZywgc3ltYm9sVGV4dCk7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnkgPSAoaSAtIDEpICogQXBwLkNvbnN0YW50cy5TWU1CT0xfSEVJR0hUO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5hZGRDaGlsZChjb250YWluZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgc2V0SWRzKGlkczpudW1iZXJbXSl7XG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuLmZvckVhY2goKGNoaWxkIDogUElYSS5Db250YWluZXIgLCBpKT0+e1xuICAgICAgICAgICAgICAgIGxldCB0ZXh0VmlldyA9IGNoaWxkLmdldENoaWxkQXQoMSkgYXMgUElYSS5UZXh0O1xuICAgICAgICAgICAgICAgIHRleHRWaWV3LnRleHQgPSB0aGlzLnNob3BzW2lkc1tpXV07XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cbn0iXX0=
