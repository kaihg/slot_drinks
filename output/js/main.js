var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var App;
(function (App) {
    var Constants = /** @class */ (function () {
        function Constants() {
        }
        Constants.SYMBOL_WIDTH = 100;
        Constants.SYMBOL_HEIGHT = 100;
        return Constants;
    }());
    App.Constants = Constants;
})(App || (App = {}));
var App;
(function (App) {
    var Main = /** @class */ (function () {
        function Main() {
            this.initPIXI();
            this.startLoading();
        }
        Main.prototype.initPIXI = function () {
            this.app = new PIXI.Application(800, 600, { backgroundColor: 0x1099bb });
            document.body.appendChild(this.app.view);
        };
        Main.prototype.startLoading = function () {
            var _this = this;
            var loadingView = new view.LoadingView();
            loadingView.x = this.app.screen.width / 2;
            loadingView.y = this.app.screen.height / 2;
            this.app.stage.addChild(loadingView);
            PIXI.loader
                .on("progress", function (loader, resource) { loadingView.updateProgress(loader.progress); })
                .add("shops", "resource/shops.json")
                .load(function () {
                loadingView.parent.removeChild(loadingView);
                _this.onLoaded();
            });
        };
        Main.prototype.onLoaded = function () {
            this.initReelView(PIXI.loader.resources.shops.data);
            this.initSpinButton();
        };
        Main.prototype.initReelView = function (shops) {
            console.log(shops);
            var reel = new view.ReelView(shops);
            reel.x = this.app.screen.width / 2;
            reel.y = this.app.screen.height / 2;
            reel.updateShop([0, 0, 0]);
            this.app.stage.addChild(reel);
            this.reelView = reel;
        };
        Main.prototype.initSpinButton = function () {
            var btn = new PIXI.Text("開始");
            btn.x = this.app.screen.width - 64;
            btn.y = this.app.screen.height - 48;
            btn.interactive = true;
            btn.on('pointerup', this.spin.bind(this));
            this.app.stage.addChild(btn);
        };
        Main.prototype.spin = function () {
            this.reelView.onSpin();
        };
        return Main;
    }());
    App.Main = Main;
})(App || (App = {}));
var view;
(function (view) {
    var LoadingView = /** @class */ (function (_super) {
        __extends(LoadingView, _super);
        function LoadingView() {
            var _this = _super.call(this) || this;
            _this.progress = 0;
            _this.color = 0xaabc13;
            return _this;
        }
        LoadingView.prototype.updateProgress = function (p) {
            var percent = p;
            this.progress = percent;
            this.clear();
            this.lineStyle(10, this.color);
            // this.drawCircle(0, 0, 2 * Math.PI * percent);
            this.arc(0, 0, 50, 0, 2 * Math.PI * percent);
            this.endFill();
        };
        return LoadingView;
    }(PIXI.Graphics));
    view.LoadingView = LoadingView;
})(view || (view = {}));
var view;
(function (view) {
    var ReelView = /** @class */ (function (_super) {
        __extends(ReelView, _super);
        // private _mask: PIXI.DisplayObject;
        function ReelView(shops) {
            var _this = _super.call(this) || this;
            _this.tempIds = [1, 1, 1];
            _this.shops = shops;
            var width = App.Constants.SYMBOL_WIDTH;
            var height = App.Constants.SYMBOL_HEIGHT;
            _this.frame = new PIXI.Graphics();
            _this.frame.lineStyle(10, 0x000000);
            _this.frame.drawRect(-width * 0.5, -height * 0.5, width, height);
            _this.frame.endFill();
            // mask
            var mask = new PIXI.Graphics();
            mask.beginFill(0xFFFFFF);
            mask.drawRect(-width * 0.5, -height * 0.5, width, height);
            mask.endFill();
            // wheel
            var wheel = new view.WheelView(shops);
            wheel.mask = mask;
            wheel.setIds(_this.tempIds);
            _this.wheel = wheel;
            _this.addChild(wheel, mask, _this.frame);
            return _this;
        }
        ReelView.prototype.updateShop = function (shopId) {
            this.wheel.setIds(shopId);
        };
        ReelView.prototype.onSpin = function () {
            if (this.spining) {
                return;
            }
            this.spining = true;
            TweenMax.fromTo(this.wheel.position, 0.5, { y: 0 }, { y: App.Constants.SYMBOL_HEIGHT, repeat: 5, ease: Linear.easeNone, onRepeat: this.swapId, onRepeatScope: this, onComplete: this.onSpinComplete, onCompleteScope: this });
        };
        ReelView.prototype.randomId = function () {
            return Math.floor(Math.random() * this.shops.length);
        };
        ReelView.prototype.swapId = function () {
            this.tempIds.unshift(this.randomId());
            this.updateShop(this.tempIds);
        };
        ReelView.prototype.onSpinComplete = function () {
            this.spining = false;
            this.tempIds.unshift(this.randomId());
            this.tempIds.unshift(this.randomId());
            this.updateShop(this.tempIds);
            TweenLite.fromTo(this.wheel.position, 1, { y: -App.Constants.SYMBOL_HEIGHT }, { y: 0 });
        };
        return ReelView;
    }(PIXI.Sprite));
    view.ReelView = ReelView;
})(view || (view = {}));
var view;
(function (view) {
    var WheelView = /** @class */ (function (_super) {
        __extends(WheelView, _super);
        function WheelView(shops) {
            var _this = _super.call(this, PIXI.Texture.EMPTY) || this;
            _this.shops = shops;
            for (var i = 0; i < 3; i++) {
                var symbolText = new PIXI.Text("", { fill: "0x000000" });
                symbolText.anchor.set(0.5);
                var bg = new PIXI.Sprite(PIXI.Texture.WHITE);
                bg.width = App.Constants.SYMBOL_WIDTH;
                bg.height = App.Constants.SYMBOL_HEIGHT;
                bg.anchor.set(0.5);
                var container = new PIXI.Container();
                container.addChild(bg, symbolText);
                container.y = (i - 1) * App.Constants.SYMBOL_HEIGHT;
                _this.addChild(container);
            }
            return _this;
        }
        WheelView.prototype.setIds = function (ids) {
            var _this = this;
            this.children.forEach(function (child, i) {
                var textView = child.getChildAt(1);
                textView.text = _this.shops[ids[i]];
            });
        };
        return WheelView;
    }(PIXI.Sprite));
    view.WheelView = WheelView;
})(view || (view = {}));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9Db25zdGFudHMudHMiLCJzcmMvTWFpbi50cyIsInNyYy92aWV3L0xvYWRpbmdWaWV3LnRzIiwic3JjL3ZpZXcvUmVlbFZpZXcudHMiLCJzcmMvdmlldy9XaGVlbFZpZXcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLElBQU8sR0FBRyxDQUtUO0FBTEQsV0FBTyxHQUFHO0lBQ047UUFBQTtRQUdBLENBQUM7UUFGaUIsc0JBQVksR0FBRyxHQUFHLENBQUM7UUFDbkIsdUJBQWEsR0FBRyxHQUFHLENBQUM7UUFDdEMsZ0JBQUM7S0FIRCxBQUdDLElBQUE7SUFIWSxhQUFTLFlBR3JCLENBQUE7QUFDTCxDQUFDLEVBTE0sR0FBRyxLQUFILEdBQUcsUUFLVDtBQ0xELElBQU8sR0FBRyxDQXVFVDtBQXZFRCxXQUFPLEdBQUc7SUFDTjtRQU1JO1lBRUksSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ2hCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUV4QixDQUFDO1FBRU8sdUJBQVEsR0FBaEI7WUFDSSxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsZUFBZSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7WUFDekUsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM3QyxDQUFDO1FBRUQsMkJBQVksR0FBWjtZQUFBLGlCQWVDO1lBZEcsSUFBSSxXQUFXLEdBQUcsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDekMsV0FBVyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1lBQzFDLFdBQVcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENB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RUQsMEJBQU0sR0FBTixVQUFPLEdBQVk7WUFBbkIsaUJBS0M7WUFKRyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxVQUFDLEtBQXNCLEVBQUcsQ0FBQztnQkFDN0MsSUFBSSxRQUFRLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQWMsQ0FBQztnQkFDaEQsUUFBUSxDQUFDLElBQUksR0FBRyxLQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZDLENBQUMsQ0FBQyxDQUFBO1FBQ04sQ0FBQztRQUVMLGdCQUFDO0lBQUQsQ0FqQ0EsQUFpQ0MsQ0FqQzhCLElBQUksQ0FBQyxNQUFNLEdBaUN6QztJQWpDWSxjQUFTLFlBaUNyQixDQUFBO0FBQ0wsQ0FBQyxFQW5DTSxJQUFJLEtBQUosSUFBSSxRQW1DViIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlIEFwcCB7XG4gICAgZXhwb3J0IGNsYXNzIENvbnN0YW50cyB7XG4gICAgICAgIHB1YmxpYyBzdGF0aWMgU1lNQk9MX1dJRFRIID0gMTAwO1xuICAgICAgICBwdWJsaWMgc3RhdGljIFNZTUJPTF9IRUlHSFQgPSAxMDA7XG4gICAgfVxufSIsIm1vZHVsZSBBcHAge1xuICAgIGV4cG9ydCBjbGFzcyBNYWluIHtcblxuICAgICAgICBwcml2YXRlIGFwcDogUElYSS5BcHBsaWNhdGlvbjtcblxuICAgICAgICBwcml2YXRlIHJlZWxWaWV3IDogdmlldy5SZWVsVmlldztcblxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcblxuICAgICAgICAgICAgdGhpcy5pbml0UElYSSgpO1xuICAgICAgICAgICAgdGhpcy5zdGFydExvYWRpbmcoKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBpbml0UElYSSgpIHtcbiAgICAgICAgICAgIHRoaXMuYXBwID0gbmV3IFBJWEkuQXBwbGljYXRpb24oODAwLCA2MDAsIHsgYmFja2dyb3VuZENvbG9yOiAweDEwOTliYiB9KTtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5hcHAudmlldyk7XG4gICAgICAgIH1cblxuICAgICAgICBzdGFydExvYWRpbmcoKTogYW55IHtcbiAgICAgICAgICAgIGxldCBsb2FkaW5nVmlldyA9IG5ldyB2aWV3LkxvYWRpbmdWaWV3KCk7XG4gICAgICAgICAgICBsb2FkaW5nVmlldy54ID0gdGhpcy5hcHAuc2NyZWVuLndpZHRoIC8gMjtcbiAgICAgICAgICAgIGxvYWRpbmdWaWV3LnkgPSB0aGlzLmFwcC5zY3JlZW4uaGVpZ2h0IC8gMjtcblxuICAgICAgICAgICAgdGhpcy5hcHAuc3RhZ2UuYWRkQ2hpbGQobG9hZGluZ1ZpZXcpO1xuXG4gICAgICAgICAgICBQSVhJLmxvYWRlclxuICAgICAgICAgICAgICAgIC5vbihcInByb2dyZXNzXCIsIChsb2FkZXI6IFBJWEkubG9hZGVycy5Mb2FkZXIsIHJlc291cmNlOiBQSVhJLmxvYWRlcnMuUmVzb3VyY2UpID0+IHsgbG9hZGluZ1ZpZXcudXBkYXRlUHJvZ3Jlc3MobG9hZGVyLnByb2dyZXNzKSB9KVxuICAgICAgICAgICAgICAgIC5hZGQoXCJzaG9wc1wiLCBcInJlc291cmNlL3Nob3BzLmpzb25cIilcbiAgICAgICAgICAgICAgICAubG9hZCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxvYWRpbmdWaWV3LnBhcmVudC5yZW1vdmVDaGlsZChsb2FkaW5nVmlldyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25Mb2FkZWQoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgb25Mb2FkZWQoKSB7XG4gICAgICAgICAgICB0aGlzLmluaXRSZWVsVmlldyhQSVhJLmxvYWRlci5yZXNvdXJjZXMuc2hvcHMuZGF0YSk7XG4gICAgICAgICAgICB0aGlzLmluaXRTcGluQnV0dG9uKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpbml0UmVlbFZpZXcoc2hvcHMgOiBzdHJpbmdbXSl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzaG9wcyk7XG4gICAgICAgICAgICBsZXQgcmVlbCA9IG5ldyB2aWV3LlJlZWxWaWV3KHNob3BzKTtcbiAgICAgICAgICAgIHJlZWwueCA9IHRoaXMuYXBwLnNjcmVlbi53aWR0aCAvIDI7XG4gICAgICAgICAgICByZWVsLnkgPSB0aGlzLmFwcC5zY3JlZW4uaGVpZ2h0IC8gMjtcbiAgICAgICAgICAgIHJlZWwudXBkYXRlU2hvcChbMCwwLDBdKTtcblxuXG4gICAgICAgICAgICB0aGlzLmFwcC5zdGFnZS5hZGRDaGlsZChyZWVsKTtcblxuICAgICAgICAgICAgdGhpcy5yZWVsVmlldyA9IHJlZWw7XG4gICAgICAgIH1cblxuICAgICAgICBpbml0U3BpbkJ1dHRvbigpe1xuICAgICAgICAgICAgbGV0IGJ0biA9IG5ldyBQSVhJLlRleHQoXCLplovlp4tcIik7XG4gICAgICAgICAgICBidG4ueCA9IHRoaXMuYXBwLnNjcmVlbi53aWR0aCAtIDY0O1xuICAgICAgICAgICAgYnRuLnkgPSB0aGlzLmFwcC5zY3JlZW4uaGVpZ2h0IC0gNDg7XG4gICAgICAgICAgICBidG4uaW50ZXJhY3RpdmU9ICB0cnVlO1xuICAgICAgICAgICAgYnRuLm9uKCdwb2ludGVydXAnLHRoaXMuc3Bpbi5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgdGhpcy5hcHAuc3RhZ2UuYWRkQ2hpbGQoYnRuKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9XG5cbiAgICAgICAgc3BpbigpeyAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5yZWVsVmlldy5vblNwaW4oKTtcbiAgICAgICAgfVxuXG5cbiAgICB9XG59XG4iLCJtb2R1bGUgdmlldyB7XG4gICAgZXhwb3J0IGNsYXNzIExvYWRpbmdWaWV3IGV4dGVuZHMgUElYSS5HcmFwaGljcyB7XG5cbiAgICAgICAgcHJpdmF0ZSBwcm9ncmVzczogbnVtYmVyID0gMDtcbiAgICAgICAgY29sb3I6IG51bWJlciA9IDB4YWFiYzEzXG5cbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICBzdXBlcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIHVwZGF0ZVByb2dyZXNzKHA6IG51bWJlcikge1xuICAgICAgICAgICAgbGV0IHBlcmNlbnQgPSBwO1xuICAgICAgICAgICAgdGhpcy5wcm9ncmVzcyA9IHBlcmNlbnQ7XG5cbiAgICAgICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICAgICAgICAgIHRoaXMubGluZVN0eWxlKDEwLCB0aGlzLmNvbG9yKTtcbiAgICAgICAgICAgIC8vIHRoaXMuZHJhd0NpcmNsZSgwLCAwLCAyICogTWF0aC5QSSAqIHBlcmNlbnQpO1xuICAgICAgICAgICAgdGhpcy5hcmMoMCwgMCwgNTAsIDAsIDIgKiBNYXRoLlBJICogcGVyY2VudCk7XG4gICAgICAgICAgICB0aGlzLmVuZEZpbGwoKTtcbiAgICAgICAgfVxuXG4gICAgfVxufVxuIiwibW9kdWxlIHZpZXcge1xuICAgIGV4cG9ydCBjbGFzcyBSZWVsVmlldyBleHRlbmRzIFBJWEkuU3ByaXRlIHtcblxuICAgICAgICBwcml2YXRlIGZyYW1lOiBQSVhJLkdyYXBoaWNzO1xuICAgICAgICBwcml2YXRlIHdoZWVsOiB2aWV3LldoZWVsVmlldztcbiAgICAgICAgcHJpdmF0ZSBzaG9wczogc3RyaW5nW107XG5cbiAgICAgICAgcHJpdmF0ZSB0ZW1wSWRzOiBudW1iZXJbXSA9IFsxLCAxLCAxXTtcbiAgICAgICAgc3BpbmluZzogYm9vbGVhbjtcbiAgICAgICAgLy8gcHJpdmF0ZSBfbWFzazogUElYSS5EaXNwbGF5T2JqZWN0O1xuXG4gICAgICAgIGNvbnN0cnVjdG9yKHNob3BzOiBzdHJpbmdbXSkge1xuICAgICAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgICAgIHRoaXMuc2hvcHMgPSBzaG9wcztcblxuICAgICAgICAgICAgbGV0IHdpZHRoID0gQXBwLkNvbnN0YW50cy5TWU1CT0xfV0lEVEg7XG4gICAgICAgICAgICBsZXQgaGVpZ2h0ID0gQXBwLkNvbnN0YW50cy5TWU1CT0xfSEVJR0hUO1xuXG4gICAgICAgICAgICB0aGlzLmZyYW1lID0gbmV3IFBJWEkuR3JhcGhpY3MoKTtcbiAgICAgICAgICAgIHRoaXMuZnJhbWUubGluZVN0eWxlKDEwLCAweDAwMDAwMCk7XG4gICAgICAgICAgICB0aGlzLmZyYW1lLmRyYXdSZWN0KC13aWR0aCAqIDAuNSwgLWhlaWdodCAqIDAuNSwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgICAgICB0aGlzLmZyYW1lLmVuZEZpbGwoKTtcblxuICAgICAgICAgICAgLy8gbWFza1xuICAgICAgICAgICAgbGV0IG1hc2sgPSBuZXcgUElYSS5HcmFwaGljcygpO1xuICAgICAgICAgICAgbWFzay5iZWdpbkZpbGwoMHhGRkZGRkYpO1xuICAgICAgICAgICAgbWFzay5kcmF3UmVjdCgtd2lkdGggKiAwLjUsIC1oZWlnaHQgKiAwLjUsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICAgICAgbWFzay5lbmRGaWxsKCk7XG5cblxuICAgICAgICAgICAgLy8gd2hlZWxcbiAgICAgICAgICAgIGxldCB3aGVlbCA9IG5ldyB2aWV3LldoZWVsVmlldyhzaG9wcyk7XG4gICAgICAgICAgICB3aGVlbC5tYXNrID0gbWFzaztcbiAgICAgICAgICAgIHdoZWVsLnNldElkcyh0aGlzLnRlbXBJZHMpO1xuICAgICAgICAgICAgdGhpcy53aGVlbCA9IHdoZWVsO1xuXG5cbiAgICAgICAgICAgIHRoaXMuYWRkQ2hpbGQod2hlZWwsIG1hc2ssIHRoaXMuZnJhbWUpO1xuXG4gICAgICAgIH1cblxuICAgICAgICB1cGRhdGVTaG9wKHNob3BJZDogbnVtYmVyW10pIHtcbiAgICAgICAgICAgIHRoaXMud2hlZWwuc2V0SWRzKHNob3BJZCk7XG4gICAgICAgIH1cblxuICAgICAgICBvblNwaW4oKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zcGluaW5nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zcGluaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIFR3ZWVuTWF4LmZyb21Ubyh0aGlzLndoZWVsLnBvc2l0aW9uLCAwLjUsIHsgeTogMCB9LCB7IHk6IEFwcC5Db25zdGFudHMuU1lNQk9MX0hFSUdIVCwgcmVwZWF0OiA1LCBlYXNlOiBMaW5lYXIuZWFzZU5vbmUsIG9uUmVwZWF0OiB0aGlzLnN3YXBJZCwgb25SZXBlYXRTY29wZTogdGhpcywgb25Db21wbGV0ZTogdGhpcy5vblNwaW5Db21wbGV0ZSwgb25Db21wbGV0ZVNjb3BlOiB0aGlzIH0pO1xuXG4gICAgICAgIH1cblxuICAgICAgICByYW5kb21JZCgpOiBudW1iZXIge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuc2hvcHMubGVuZ3RoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN3YXBJZCgpIHtcbiAgICAgICAgICAgIHRoaXMudGVtcElkcy51bnNoaWZ0KHRoaXMucmFuZG9tSWQoKSk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNob3AodGhpcy50ZW1wSWRzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9uU3BpbkNvbXBsZXRlKCkge1xuXG4gICAgICAgICAgICB0aGlzLnNwaW5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMudGVtcElkcy51bnNoaWZ0KHRoaXMucmFuZG9tSWQoKSk7XG4gICAgICAgICAgICB0aGlzLnRlbXBJZHMudW5zaGlmdCh0aGlzLnJhbmRvbUlkKCkpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVTaG9wKHRoaXMudGVtcElkcyk7XG5cbiAgICAgICAgICAgIFR3ZWVuTGl0ZS5mcm9tVG8odGhpcy53aGVlbC5wb3NpdGlvbiwgMSwgeyB5OiAtQXBwLkNvbnN0YW50cy5TWU1CT0xfSEVJR0hUIH0sIHsgeTogMCB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0iLCJtb2R1bGUgdmlldyB7XG4gICAgZXhwb3J0IGNsYXNzIFdoZWVsVmlldyBleHRlbmRzIFBJWEkuU3ByaXRlIHtcblxuICAgICAgICBwcml2YXRlIHNob3BzOiBzdHJpbmdbXTtcblxuICAgICAgICBjb25zdHJ1Y3RvcihzaG9wczogc3RyaW5nW10pIHtcbiAgICAgICAgICAgIHN1cGVyKFBJWEkuVGV4dHVyZS5FTVBUWSk7XG4gICAgICAgICAgICB0aGlzLnNob3BzID0gc2hvcHM7XG5cblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgc3ltYm9sVGV4dCA9IG5ldyBQSVhJLlRleHQoXCJcIiwgeyBmaWxsOiBcIjB4MDAwMDAwXCIgfSk7XG4gICAgICAgICAgICAgICAgc3ltYm9sVGV4dC5hbmNob3Iuc2V0KDAuNSk7XG5cbiAgICAgICAgICAgICAgICBsZXQgYmcgPSBuZXcgUElYSS5TcHJpdGUoUElYSS5UZXh0dXJlLldISVRFKTtcbiAgICAgICAgICAgICAgICBiZy53aWR0aCA9IEFwcC5Db25zdGFudHMuU1lNQk9MX1dJRFRIO1xuICAgICAgICAgICAgICAgIGJnLmhlaWdodCA9IEFwcC5Db25zdGFudHMuU1lNQk9MX0hFSUdIVDtcbiAgICAgICAgICAgICAgICBiZy5hbmNob3Iuc2V0KDAuNSk7XG5cbiAgICAgICAgICAgICAgICBsZXQgY29udGFpbmVyID0gbmV3IFBJWEkuQ29udGFpbmVyKCk7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENoaWxkKGJnLCBzeW1ib2xUZXh0KTtcbiAgICAgICAgICAgICAgICBjb250YWluZXIueSA9IChpIC0gMSkgKiBBcHAuQ29uc3RhbnRzLlNZTUJPTF9IRUlHSFQ7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmFkZENoaWxkKGNvbnRhaW5lcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBzZXRJZHMoaWRzOm51bWJlcltdKXtcbiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQgOiBQSVhJLkNvbnRhaW5lciAsIGkpPT57XG4gICAgICAgICAgICAgICAgbGV0IHRleHRWaWV3ID0gY2hpbGQuZ2V0Q2hpbGRBdCgxKSBhcyBQSVhJLlRleHQ7XG4gICAgICAgICAgICAgICAgdGV4dFZpZXcudGV4dCA9IHRoaXMuc2hvcHNbaWRzW2ldXTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxufSJdfQ==
